<!doctype html>
<html lang="zh-Hant-TW">

<head>
    <title>untitled</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/Start/jquery-ui.css">
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/animations/scale.css" />
</head>

<body>
    <div w3-include-html="ACG_header.html"></div>
    <br><br><br>

    <div class="container-xl animate__animated animate__rollIn animate__delay-1s">
        <div class="card my-3 w-100" style="background-color:transparent;border:none;">
            <div class="row no-gutters">
                <div class="col-sm-4 col-xs-12">
                    <img class="img-fluid rounded lazy w-100" src="../images/loading.gif" style="height:450px;">
                </div>
                <div class="col-sm-8 col-xs-12">
                    <div class="card-body">
                        <div class="col-12 text-primary font-weight-bold display-3" id="edit"></div>
                        <div class="col-12 h2 mt-2 text-success"></div>
                        <div class="col-12 h2 mt-2 text-danger"></div>
                        <div class="col-12 h2 mt-2 text-warning"></div>
                        <div class="col-12 h2"></div>
                        <blockquote class="blockquote col-12">
                            <footer class="blockquote-footer text-muted text-right" style="font-size:1.5rem;">
                            </footer>
                        </blockquote>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 mt-3" id="content">
        </div>

        <div class="row justify-content-center h1 text-center" style="color:#AE57A4">
            <u>留言</u>
        </div><br>
        <div id="disqus_thread"></div>
    </div>

    <div id="dialog" title="封印之地" style="display: none;">
        <div class="col-sm-12 form-group mt-3">
            <form>
                <label for="secret" class="h5">請輸入密碼:</label>
                <input type="password" id="secret" class="form-control" maxlength="10"></input>
                <button type="submit" class="btn btn-primary mt-2 float-right">確定</button>
            </form>
        </div>
    </div>

    <div id="goTop">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor"
            class="bi bi-arrow-up-circle-fill" viewBox="0 0 16 16">
            <path
                d="M16 8A8 8 0 1 0 0 8a8 8 0 0 0 16 0zm-7.5 3.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V11.5z" />
        </svg>
    </div>

    <div style="position:fixed;left:5vw;top:50vh;">
        <button class="close" disabled id="leftBtn" style="color:#4F9D9D;">
            <i class="fas fa-chevron-left h1 font-weight-bold"></i>
        </button>
    </div>
    <div style="position:fixed;right:5vw;top:50vh;">
        <button class="close" disabled id="rightBtn" style="color:#4F9D9D;">
            <i class="fas fa-chevron-right h1 font-weight-bold"></i>
        </button>
    </div>

    <div w3-include-html="../footer.html"></div>

    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous">
    </script>
    <script src="https://www.w3schools.com/lib/w3.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="../js/sha512.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../js/fairyDustCursor.js"></script>
    <script src="../js/bubbly-bg.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/8.6.5/firebase-database.min.js"
        integrity="sha512-x+FKkd5Tc/5BaHtn/ZnRsQlzaEihtLaCOev36dCv5eeyGEDf5ou59tz7q6CypiKBN/L51E0Jd5S7jxIg1v8lcg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="../js/jquery.blockUI.js"></script>
    <script id="dsq-count-scr" src="//gustylittleworld.disqus.com/count.js" async></script>
    <script async src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.4.0/dist/lazyload.min.js"></script>
    <script src="../js/social-share-kit.js"></script>
    <script src="../js/common.js"></script>

    <script>
        w3.includeHTML(); //引入html
        var getUrlString = location.href;
        var url = new URL(getUrlString);
        var urlOrder = url.searchParams.get('order');
        var ACGArray = [];

        //disqus留言設定
        // var disqus_config = function () {
        //   this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
        //   this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        // };
        (function () { // DON'T EDIT BELOW THIS LINE
            var d = document,
                s = d.createElement('script');
            s.src = 'https://gustylittleworld.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();

        // 抓網頁參數資料+顯示
        $(document).ready(function () {
            $.blockUI({
                message: '<div class="spinner-border text-primary h1" style="width: 3rem; height: 3rem;" role="status"><span class="sr-only"></span></div>',
                css: {
                    borderWidth: '0px',
                    backgroundColor: 'transparent'
                },
            });
            let nextTitle = ''
            let prevTitle = ''
            database.ref('/ACG').on('value', function (result) {
                ACGArray = result.val()
                for (let i = 0; i < ACGArray.length; i = i + 1) {
                    if (urlOrder == ACGArray[i].order) {
                        document.title = ACGArray[i].title;
                        $('.card').find('img').eq(0).data('src', ACGArray[i].coverImg).
                        attr('data-src', ACGArray[i].coverImg)
                        $('.card-body').find('div').each(function (index, value) {
                            if (index == 0) {
                                $(this).html(ACGArray[i].title)
                            }
                            if (index == 1) {
                                if (ACGArray[i].type == '動畫' || ACGArray[i].type == '漫畫') {
                                    $(this).html(ACGArray[i].type + '、' + ACGArray[i].collect +
                                        '集');
                                } else {
                                    $(this).html(ACGArray[i].type + '、' + ACGArray[i].collect +
                                        '小時');
                                }
                            }
                            if (index == 2) {
                                $(this).html(ACGArray[i].time)
                            }
                            if (index == 3) {
                                let rateHtml = '';
                                if (ACGArray[i].rate.toString().indexOf('.') != -1) {
                                    // $(this).append('<i class="fas fa-star-half-alt"></i>');
                                    for (let j = 0; j < 5; j = j + 1) {
                                        if (j < parseInt(ACGArray[i].rate)) {
                                            rateHtml += '<i class="fas fa-star"></i>';
                                        } else {
                                            rateHtml += '<i class="fas fa-star-half-alt"></i>';
                                            j = j + 1;
                                            if (j < 5) {
                                                for (let k = j; k < 5; k++) {
                                                    rateHtml += '<i class="far fa-star"></i>';
                                                }
                                                break;
                                            }
                                        }
                                    }
                                } else {
                                    for (let j = 0; j < 5; j = j + 1) {
                                        if (j < ACGArray[i].rate) {
                                            rateHtml += '<i class="fas fa-star"></i>';
                                        } else {
                                            rateHtml += '<i class="far fa-star"></i>';
                                        }
                                    }
                                }
                                $(this).html(rateHtml);
                            }
                            if (index == 4) {
                                $(this).html('『' + ACGArray[i].say + '』');
                            }
                        });
                        $('.card-body').find('footer').eq(0).html(ACGArray[i].say_author);
                        $('#content').html(ACGArray[i].content);
                    }
                    if (parseInt(urlOrder) + parseInt(1) == ACGArray[i].order) {
                        $('#leftBtn').data('order', ACGArray[i].order).
                        attr('data-order', ACGArray[i].order).
                        addClass('hvr-backward')
                        nextTitle = ACGArray[i].title
                    }
                    if (parseInt(urlOrder) - 1 == ACGArray[i].order) {
                        $('#rightBtn').data('order', ACGArray[i].order).
                        attr('data-order', ACGArray[i].order).
                        addClass('hvr-forward')
                        prevTitle = ACGArray[i].title
                    }
                }
                buildTip(nextTitle, prevTitle)
                $("img").on("error", function (e) {
                    $(this).attr("src", "../images/error.gif");
                });
                $('body').find('iframe').each(function () {
                    if (typeof $(this).attr("src") != 'undefined' &&
                        $(this).attr("src").indexOf("youtube") != -1) {
                        $(this).wrap('<div class="video-container"></div>')
                    }
                })
                $.unblockUI();
                new LazyLoad();
            });
        });

        //上下一篇切換
        $('#leftBtn').click(function () {
            location.href = 'Detail.html?order=' + $(this).data('order')
        })
        $('#rightBtn').click(function () {
            location.href = 'Detail.html?order=' + $(this).data('order')
        })

        //雙擊標題出現封印之地
        $('#edit').dblclick(function () {
            $("#dialog").dialog({
                resizable: false,
            });
        });

        //封印之地的密碼框和確認
        $('#secret').next('button').click(function (e) {
            e.preventDefault()
            if (sha512($('#secret').val().trim()) ==
                '3f9b890fb564b973251f8c85f5dd542b7c09065975e7e3a4cde08162d06402cb552d53f70d47c65895031e248b3ef37713d13b23f49c67ea9d2e58531d064e6d'
            ) {
                window.open('Edit.html?order=' + urlOrder);
                $('#secret').val('')
                $("#dialog").dialog('close');
            } else {
                Swal.fire({
                    icon: 'error',
                    html: '<span class="text-danger h4"><i class="fas fa-ban"></i>凡人無法進入<i class="fas fa-ban"></i></span>',
                    showConfirmButton: false,
                });
                $('#secret').val('')
                $("#dialog").dialog('close');
            }
        });

        //建造提示文字
        function buildTip(nextTitle, prevTitle) {
            if (nextTitle != '') {
                $('#leftBtn').attr('disabled', false)
                tippy('#leftBtn', {
                    animation: 'scale',
                    content: '下一篇: 『' + nextTitle + '』',
                });
            }
            if (prevTitle != '') {
                $('#rightBtn').attr('disabled', false)
                tippy('#rightBtn', {
                    animation: 'scale',
                    content: '上一篇: 『' + prevTitle + '』',
                });
            }
        }
    </script>

</body>

</html>